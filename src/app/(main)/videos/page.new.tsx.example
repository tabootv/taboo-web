/**
 * Example: Migrated Videos Page using new API structure
 * 
 * This demonstrates how to migrate from old API to new TanStack Query hooks
 * 
 * Migration steps:
 * 1. Replace useInfiniteScrollPagination with useVideoList
 * 2. Use new query hooks from @/api/queries
 * 3. Remove manual data fetching logic
 */

'use client';

import { LoadingScreen } from '@/components/ui';
import { VideoCard, VideoCardSkeleton, VideoEmptyState } from '@/components/video';
import { useVideoList } from '@/api/queries';
import { useMemo } from 'react';

export default function VideosPage() {
  // New: Use TanStack Query hook instead of custom infinite scroll
  const {
    data,
    isLoading,
    isFetchingNextPage,
    hasNextPage,
    fetchNextPage,
    isError,
    error,
  } = useVideoList({
    short: false,
    is_short: false,
    type: 'video',
    published: true,
    sort_by: 'published_at',
    order: 'desc',
  });

  // Flatten pages into single array
  const videosList = useMemo(() => {
    return data?.pages.flatMap((page) => page.data) || [];
  }, [data]);

  if (isLoading) {
    return <LoadingScreen variant="feed" />;
  }

  if (isError) {
    return (
      <div className="min-h-screen bg-background flex items-center justify-center">
        <div className="text-center">
          <p className="text-red-primary mb-4">Error loading videos</p>
          <p className="text-text-secondary text-sm">{error?.message}</p>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-background">
      <div className="max-w-[1400px] mx-auto px-4 md:px-8 lg:px-12 py-8">
        <div className="flex items-center justify-between mb-6">
          <p className="text-sm md:text-base font-semibold text-white/80 tracking-tight">Videos</p>
        </div>

        {videosList.length > 0 ? (
          <>
            <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 md:gap-5">
              {videosList.map((video) => (
                <VideoCard key={video.uuid || video.id} video={video} />
              ))}
              {isFetchingNextPage &&
                Array.from({ length: 6 }).map((_, i) => <VideoCardSkeleton key={`skeleton-${i}`} />)}
            </div>

            {hasNextPage && (
              <div className="flex justify-center mt-8">
                <button
                  onClick={() => fetchNextPage()}
                  disabled={isFetchingNextPage}
                  className="px-6 py-2 bg-surface hover:bg-surface/80 text-white rounded-lg transition-colors disabled:opacity-50"
                >
                  {isFetchingNextPage ? 'Loading...' : 'Load More'}
                </button>
              </div>
            )}

            {!hasNextPage && videosList.length > 0 && (
              <div className="flex justify-center mt-8 text-white/40 text-sm">You've seen it all</div>
            )}
          </>
        ) : (
          <VideoEmptyState />
        )}
      </div>
    </div>
  );
}

